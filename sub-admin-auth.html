<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>рж╕рж╛ржм-ржЕрзНржпрж╛ржбржорж┐ржи ржкрзНржпрж╛ржирзЗрж▓: ржирж┐ржмржирзНржзржи ржУ рж▓ржЧржЗржи</title>
    <style>
        /* ржЖржкржирж╛рж░ CSS рж╕рзНржЯрж╛ржЗрж▓ ржПржЦрж╛ржирзЗ ржпрзБржХрзНржд ржХрж░рзБржи */
        body { font-family: Arial, sans-serif; background-color: #f4f7f6; }
        #auth-panel { max-width: 450px; margin: 50px auto; padding: 30px; background: #fff; border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        input, select, button { width: 100%; padding: 10px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        button { background-color: #007bff; color: white; cursor: pointer; font-weight: bold; }
        button:hover { background-color: #0056b3; }
        h3 { color: #333; border-bottom: 2px solid #eee; padding-bottom: 10px; margin-top: 20px; }
        .success-message { text-align: center; color: green; font-size: 1.1em; }
    </style>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script> 
</head>
<body>

    <div id="auth-panel">
        <h2>ржХржирзНржЯрзНрж░рзЛрж▓/рж╕рж╛ржм-ржЕрзНржпрж╛ржбржорж┐ржи ржЕржерзЗржирзНржЯрж┐ржХрзЗрж╢ржи</h2>

        <button id="reg-btn" onclick="showForm('register')">ржирж┐ржмржирзНржзржи тЬНя╕П</button>
        <button id="login-btn" onclick="showForm('login')">рж▓ржЧржЗржи ЁЯФС</button>

        <div id="form-container">
            <!-- ржлрж░рзНржо ржХржирзНржЯрзЗржирзНржЯ ржПржЦрж╛ржирзЗ ржжрзЗржЦрж╛ржмрзЗ -->
        </div>
    </div>
    
    <script>
        // ----------------- Firebase Configuration -----------------
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyA1fCD4rPhcosqGzk6iHltDI3ePFR4JNEY",
  authDomain: "comillalg-gov-bd.firebaseapp.com",
  databaseURL: "https://comillalg-gov-bd-default-rtdb.firebaseio.com",
  projectId: "comillalg-gov-bd",
  storageBucket: "comillalg-gov-bd.firebasestorage.app",
  messagingSenderId: "906711849504",
  appId: "1:906711849504:web:d4dc33382d37abe9d93a45",
  measurementId: "G-F9GZKXH3QL"
};
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const auth = firebase.auth(); 
        
        // ----------------- Auth State & Data Caching -----------------
        
        let currentStep = 1;
        let registrationData = {}; // ржзрж╛ржк рзз ржПрж░ ржбрзЗржЯрж╛ ржПржЦрж╛ржирзЗ ржХрзНржпрж╛рж╢ ржХрж░рж╛ рж╣ржмрзЗ
        
        // ----------------- Auth Logic (JavaScript Functions) -----------------
        
        function showForm(type) {
            const container = document.getElementById('form-container');
            container.innerHTML = '';
            currentStep = 1; 

            if (type === 'register') {
                container.innerHTML = `
                    <h3>ржзрж╛ржк рзз: рж╕рж╛ржзрж╛рж░ржг рждржерзНржп ржкрзВрж░ржг</h3>
                    <p style="color:red; font-size: 0.9em;">* ржЪрж┐рж╣рзНржирж┐ржд ржлрж┐рж▓рзНржбржЧрзБрж▓рзЛ ржкрзВрж░ржг ржХрж░рж╛ ржмрж╛ржзрзНржпрждрж╛ржорзВрж▓ржХред тЭЧя╕П</p>
                    
                    <input type="text" id="nameBn" placeholder="ржирж╛ржо (ржмрж╛ржВрж▓рж╛ржпрж╝) *" required value="${registrationData.name_bn || ''}">
                    <input type="text" id="nameEn" placeholder="ржирж╛ржо (ржЗржВрж░рзЗржЬрж┐рждрзЗ) *" required value="${registrationData.name_en || ''}">
                    <input type="number" id="nid" placeholder="ржЬрж╛рждрзАржпрж╝ ржкрж░рж┐ржЪржпрж╝ржкрждрзНрж░ ржиржорзНржмрж░ (рззрзж ржмрж╛ рззрзн ржбрж┐ржЬрж┐ржЯ) *" required value="${registrationData.nid || ''}">
                    <input type="tel" id="mobile" placeholder="рззрзз ржбрж┐ржЬрж┐ржЯрзЗрж░ ржорзЛржмрж╛ржЗрж▓ ржиржорзНржмрж░ *" required value="${registrationData.mobile || ''}">
                    <input type="password" id="password" placeholder="ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб ржжрж┐ржи *" required>
                    
                    <select id="accountType">
                        <option value="Upazila Admin">ржЙржкржЬрзЗрж▓рж╛ ржЕрзНржпрж╛ржбржорж┐ржи</option>
                    </select>
                    
                    <button onclick="nextStep()">ржкрж░ржмрж░рзНрждрзА ЁЯСЙ</button>
                `;
            } else if (type === 'login') {
                container.innerHTML = `
                    <h3>рж▓ржЧржЗржи ржХрж░рзБржи</h3>
                    <input type="tel" id="loginMobile" placeholder="ржорзЛржмрж╛ржЗрж▓ ржиржорзНржмрж░" required>
                    <input type="password" id="loginPassword" placeholder="ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб" required>
                    <button onclick="loginSubAdmin()">рж▓ржЧржЗржи ржХрж░рзБржи ЁЯФС</button>
                `;
            }
        }

        // ---------- ржзрж╛ржк рзз ржПрж░ ржбрзЗржЯрж╛ ржпрж╛ржЪрж╛ржЗ ржПржмржВ ржХрзНржпрж╛рж╢ ----------
        function nextStep() {
            // ржзрж╛ржк рзз ржерзЗржХрзЗ рждржерзНржп рж╕ржВржЧрзНрж░рж╣
            const nameBn = document.getElementById('nameBn').value.trim();
            const nameEn = document.getElementById('nameEn').value.trim();
            const nid = document.getElementById('nid').value.trim();
            const mobile = document.getElementById('mobile').value.trim();
            const password = document.getElementById('password').value;
            const accountType = document.getElementById('accountType').value;
            
            // --- рждржерзНржп ржпрж╛ржЪрж╛ржЗ (Validation Check) ---
            if (!nameBn || !nameEn || !nid || !mobile || !password) {
                alert("ржжрзЯрж╛ ржХрж░рзЗ * ржЪрж┐рж╣рзНржирж┐ржд рж╕ржХрж▓ ржЖржмрж╢рзНржпрж┐ржХ ржлрж┐рж▓рзНржб ржкрзВрж░ржг ржХрж░рзБржиред");
                return; 
            }
            if (mobile.length !== 11 || isNaN(mobile)) {
                alert("ржжрзЯрж╛ ржХрж░рзЗ рж╕ржарж┐ржХ рззрзз ржбрж┐ржЬрж┐ржЯрзЗрж░ ржорзЛржмрж╛ржЗрж▓ ржиржорзНржмрж░ ржжрж┐ржиред");
                return;
            }
            if (password.length < 6) {
                alert("ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб ржХржоржкржХрзНрж╖рзЗ рзм ржЕржХрзНрж╖рж░рзЗрж░ рж╣рждрзЗ рж╣ржмрзЗред");
                return;
            }
            
            // ржнрзНржпрж╛рж▓рж┐ржбрзЗрж╢ржи рж╕ржлрж▓ рж╣рж▓рзЗ: ржбрзЗржЯрж╛ ржХрзНржпрж╛рж╢ ржХрж░рзБржи
            registrationData = {
                name_bn: nameBn,
                name_en: nameEn,
                nid: nid,
                mobile: mobile,
                password: password, 
                account_type: accountType
            };

            // ржзрж╛ржк рзи рж▓рзЛржб
            const container = document.getElementById('form-container');
            container.innerHTML = `
                <h3>ржзрж╛ржк рзи: ржарж┐ржХрж╛ржирж╛ рж╕ржорзНржкрж░рзНржХрж┐ржд рждржерзНржп</h3>
                
                <select id="addressType">
                    <option value="рж╕рзНржерж╛ржпрж╝рзА">рж╕рзНржерж╛ржпрж╝рзА ржарж┐ржХрж╛ржирж╛</option>
                    <option value="ржмрж░рзНрждржорж╛ржи">ржмрж░рзНрждржорж╛ржи ржарж┐ржХрж╛ржирж╛</option>
                </select>
                
                <label style="display:block; margin-bottom: 5px;">ржЬрзЗрж▓рж╛: ржХрзБржорж┐рж▓рзНрж▓рж╛ ЁЯУН</label>
                <select id="upazila" required>
                    <option value="">ржЙржкржЬрзЗрж▓рж╛/ ржкрзМрж░рж╕ржнрж╛ ржирж┐рж░рзНржмрж╛ржЪржи ржХрж░рзБржи *</option>
                    <option value="ржЪрзМржжрзНржжржЧрзНрж░рж╛ржо">ржЪрзМржжрзНржжржЧрзНрж░рж╛ржо</option>
                    <option value="ржХрзБржорж┐рж▓рзНрж▓рж╛ рж╕ржжрж░">ржХрзБржорж┐рж▓рзНрж▓рж╛ рж╕ржжрж░</option>
                    <!-- ржЕржирзНржпрж╛ржирзНржп ржЙржкржЬрзЗрж▓рж╛рж░ рждрж╛рж▓рж┐ржХрж╛ -->
                </select>
                
                <button onclick="currentStep = 1; showForm('register')">ржкрзВрж░рзНржмржмрж░рзНрждрзА</button>
                <button onclick="registerSubAdmin()">ржирж┐ржмржирзНржзржи ржХрж░рзБржи тЬЕ</button>
            `;
            currentStep = 2;
        }

        // ---------- ржорзВрж▓ ржирж┐ржмржирзНржзржи ржлрж╛ржВрж╢ржи (ржХрзНржпрж╛рж╢ ржХрж░рж╛ ржбрзЗржЯрж╛ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ) ----------
        function registerSubAdmin() {
            // ржзрж╛ржк рзи ржерзЗржХрзЗ ржбрзЗржЯрж╛ рж╕ржВржЧрзНрж░рж╣
            const upazila = document.getElementById('upazila').value;
            const addressType = document.getElementById('addressType').value;
            
            // ржЪрзВрзЬрж╛ржирзНржд ржпрж╛ржЪрж╛ржЗ (Final Validation)
            if (!upazila || upazila === "") {
                alert("ржжрзЯрж╛ ржХрж░рзЗ ржЙржкржЬрзЗрж▓рж╛/ ржкрзМрж░рж╕ржнрж╛ ржирж┐рж░рзНржмрж╛ржЪржи ржХрж░рзБржиред ржПржЯрж┐ ржЖржмрж╢рзНржпрж┐ржХред");
                return;
            }

            const mobile = registrationData.mobile;
            const password = registrationData.password;
            const nameBn = registrationData.name_bn;

            if (!mobile || !password) {
                 alert("ржирж┐ржмржирзНржзржи ржбрзЗржЯрж╛ рж╣рж╛рж░рж┐ржпрж╝рзЗ ржЧрзЗржЫрзЗред ржЕржирзБржЧрзНрж░рж╣ ржХрж░рзЗ ржЖржмрж╛рж░ рж╢рзБрж░рзБ ржХрж░рзБржиред");
                 return;
            }


            // Firebase Auth ржПрж░ ржЬржирзНржп ржорзЛржмрж╛ржЗрж▓ржХрзЗ email ржлрж░ржорзНржпрж╛ржЯрзЗ ржкрж░рж┐ржмрж░рзНрждржи
            const emailAsId = mobile + "@verifydomain.com"; 

            // 1. Firebase Authentication ржжрзНржмрж╛рж░рж╛ ржЕрзНржпрж╛ржХрж╛ржЙржирзНржЯ рждрзИрж░рж┐
            auth.createUserWithEmailAndPassword(emailAsId, password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    
                    // 2. Realtime Database ржП ржЕрждрж┐рж░рж┐ржХрзНржд рждржерзНржп рж╕ржВрж░ржХрзНрж╖ржг
                    database.ref('sub_admin_requests/' + user.uid).set({
                        ...registrationData, // ржХрзНржпрж╛рж╢ ржХрж░рж╛ ржбрзЗржЯрж╛
                        password: null, // ржирж┐рж░рж╛ржкрждрзНрждрж╛ ржХрж╛рж░ржгрзЗ ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб рж╕рзЗржн ржХрж░рж╛ ржЙржЪрж┐ржд ржирж╛
                        upazila: upazila,
                        address_type: addressType,
                        status: 'Pending', // ржЕржирзБржорзЛржжржирзЗрж░ ржЬржирзНржп ржЕржкрзЗржХрзНрж╖рж╛рж░ржд
                        created_at: firebase.database.ServerValue.TIMESTAMP
                    })
                    .then(() => {
                        showSuccessMessage(nameBn);
                    });
                })
                .catch((error) => {
                    alert("ржирж┐ржмржирзНржзржи ржмрзНржпрж░рзНрже: " + error.message);
                });
        }

        // ---------- рж▓ржЧржЗржи ржлрж╛ржВрж╢ржи ----------
        function loginSubAdmin() {
            const mobile = document.getElementById('loginMobile').value;
            const password = document.getElementById('loginPassword').value;
            const emailAsId = mobile + "@verifydomain.com";

            auth.signInWithEmailAndPassword(emailAsId, password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    
                    // Realtime Database ржерзЗржХрзЗ ржЗржЙржЬрж╛рж░рзЗрж░ рж╕рзНржЯрзНржпрж╛ржЯрж╛рж╕ ржЪрзЗржХ ржХрж░рж╛
                    database.ref('sub_admin_requests/' + user.uid + '/status').once('value')
                        .then((snapshot) => {
                            const status = snapshot.val();
                            
                            if (status === 'Approved') {
                                // тЬФя╕П рж╕ржлрж▓ рж▓ржЧржЗржи: ржмрзНржпржХрзНрждрж┐ржЧржд ржбрзНржпрж╛рж╢ржмрзЛрж░рзНржбрзЗ рж░рж┐ржбрж╛ржЗрж░рзЗржХрзНржЯ ржХрж░рзБржи
                                window.location.href = 'sub-admin-dashboard.html'; 
                            } else {
                                // тЭМ ржЕржирзБржорзЛржжрж┐ржд ржирзЯ: рж▓ржЧржЖржЙржЯ ржХрж░рзБржи ржПржмржВ ржорзЗрж╕рзЗржЬ ржжрзЗржЦрж╛ржи
                                auth.signOut();
                                alert("ржЖржкржирж╛рж░ ржЕрзНржпрж╛ржХрж╛ржЙржирзНржЯржЯрж┐ ржПржЦржиржУ ржХрж░рзНрждрзГржкржХрзНрж╖рзЗрж░ ржжрзНржмрж╛рж░рж╛ ржЕржирзБржорзЛржжрж┐ржд рж╣ржпрж╝ржирж┐ред");
                            }
                        });
                })
                .catch((error) => {
                    alert("рж▓ржЧржЗржи ржмрзНржпрж░рзНрже: ржорзЛржмрж╛ржЗрж▓/ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб ржнрзБрж▓ ржмрж╛ ржЕрзНржпрж╛ржХрж╛ржЙржирзНржЯ ржирзЗржЗред");
                });
        }
        
        // ---------- ржЗржЙржЯрж┐рж▓рж┐ржЯрж┐ ржлрж╛ржВрж╢ржи ----------
        function showSuccessMessage(name) {
            document.getElementById('auth-panel').innerHTML = `
                <div class="success-message">
                    <h2>тЬиржЕржнрж┐ржиржирзНржжржи, ${name}!тЬи</h2>
                    <p>ржЖржкржирж╛рж░ ржЖржмрзЗржжржи ржПржЦржи -> ЁЯзСтАНЁЯТ╗ M┬▓H. TUSAR _ COMPUTECH ЁЯТ╗ ржХрж░рзНрждрзГржкржХрзНрж╖рзЗрж░ тАУ ржирж┐ржХржЯ ржЕржирзБржорзЛржжржирзЗрж░ ржЬржирзНржп ржЕржкрзЗржХрзНрж╖рж╛ ржХрж░ржЫрзЗред</p>
                    <p style="margin-top: 20px;">ржЕрзНржпрж╛ржХрж╛ржЙржирзНржЯржЯрж┐ ржЕржирзБржорзЛржжрж┐ржд/рж╕ржХрзНрж░рж┐ржпрж╝ рж╣рж▓рзЗ ржЖржкржирж╛ржХрзЗ ржЗржорзЗрж▓ ржмрж╛ ржорзЛржмрж╛ржЗрж▓ ржиржорзНржмрж░рзЗ ржорзЗрж╕рзЗржЬ ржкрзЗрж░ржг ржХрж░рж╛ рж╣ржмрзЗред</p>
                    <button onclick="window.location.reload()">ржкрзБржирж░рж╛рзЯ рж▓рзЛржб ржХрж░рзБржи</button>
                </div>
            `;
        }
    </script>
</body>
</html>

